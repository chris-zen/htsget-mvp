on: [pull_request]
name: benchmark pull requests
jobs:
  run-htsget-search-benchmark:
    name: run benchmark
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: htsget-search
    steps:
      - uses: actions/checkout@master
      - uses: jasonwilliams/criterion-compare-action@move_to_actions
        with:
          benchName: "LIGHT" # Optional. Compare only this benchmark target
          token: ${{ secrets.GITHUB_TOKEN }}
  run-htsget-http-actix-benchmarks:
    name: run benchmark
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: htsget-http-actix
    steps:
      - uses: actions/checkout@master
      - run: pwd
      - name: Start the hstget-rs server
        run: cargo run --release & 
      - name: Start the hstget-refserver server
        run: bash benches/docker-htsget-refserver.sh
      - uses: jasonwilliams/criterion-compare-action@move_to_actions
        with:
          benchName: "LIGHT" # Optional. Compare only this benchmark target
          token: ${{ secrets.GITHUB_TOKEN }}